#!/usr/bin/env bash
set -euo pipefail

# TypeScript
if [ -d "typescript" ]; then
    echo "--- TypeScript ---"
    cd typescript
    node scripts/version-sync.mjs
    git add package.json
    
    if [ -f pnpm-lock.yaml ]; then
      git add pnpm-lock.yaml
    fi
    if [ -f package-lock.json ]; then
      git add package-lock.json
    fi
    
    # Run lint-staged directly (standardized)
    npx lint-staged
    
    # Check types if script exists
    if npm run | grep -q "typecheck"; then
        npm run typecheck
    else
        npx tsc --noEmit
    fi
    
    npm run test
    cd ..
fi

# Python
if [ -d "python" ]; then
    echo "--- Python ---"
    cd python
    pytest
    cd ..
fi
