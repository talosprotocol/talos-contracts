#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

set -e

echo "ğŸ” Running pre-commit validation..."

# 1. TypeScript Validation
echo "--- TypeScript ---"
if [ -d "typescript" ]; then
    cd typescript
    
    # Version bump
    echo "ğŸ“¦ Syncing version..."
    npm run version:sync

    # Lint staged (typescript)
    echo "âœ¨ Running lint-staged (typescript)..."
    npx lint-staged

    # Build & Test
    echo "ğŸ—ï¸  Building..."
    npm run build
    
    echo "ğŸ§ª Running tests..."
    npm run test
    
    # Stage version bump
    git add package.json
    
    cd ..
fi

# 2. Python Validation
echo "--- Python ---"
if [ -d "python" ]; then
    cd python
    # Ideally checking linting here too, but for now just tests as per phase 0
    echo "ğŸ§ª Running Python tests..."
    pytest
    cd ..
fi

echo "âœ… All pre-commit checks passed"
