{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://talosprotocol.com/schemas/tga/v1/tool_effect.schema.json",
  "title": "TGA Tool Effect (Hardened v1)",
  "description": "The recorded outcome of a tool execution.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_id",
    "schema_version",
    "trace_id",
    "plan_id",
    "tool_effect_id",
    "tool_call_id",
    "tool_call_digest",
    "ts",
    "outcome",
    "_digest_alg",
    "_digest"
  ],
  "properties": {
    "schema_id": { "const": "talos.tga.tool_effect" },
    "schema_version": { "const": "tga.v1" },
    "trace_id": { "$ref": "../../common/uuidv7.schema.json" },
    "plan_id": { "$ref": "../../common/uuidv7.schema.json" },
    "tool_effect_id": { "$ref": "../../common/uuidv7.schema.json" },
    "tool_call_id": { "$ref": "../../common/uuidv7.schema.json" },
    "tool_call_digest": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]{43,44}$",
      "description": "base64url SHA-256 of the ToolCall."
    },
    "ts": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z$"
    },
    "outcome": {
      "type": "object",
      "required": ["status", "summary"],
      "properties": {
        "status": { "enum": ["SUCCESS", "FAILURE", "ERROR"] },
        "summary": { "type": "string", "maxLength": 5000 },
        "external_refs": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["kind", "id"],
            "properties": {
              "kind": { "type": "string" },
              "id": { "type": "string" }
            }
          }
        }
      }
    },
    "meta": {
      "type": "object",
      "additionalProperties": { "type": ["string", "number", "boolean", "null"] }
    },
    "_digest_alg": { "enum": ["sha256"] },
    "_digest": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]{43,44}$"
    }
  }
}
