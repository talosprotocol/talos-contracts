{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://talos.network/schemas/a2a/sse_event.schema.json",
  "type": "object",
  "required": ["event", "data"],
  "properties": {
    "event": {
      "type": "string",
      "enum": ["task.update", "task.complete", "task.error", "heartbeat"]
    },
    "id": {
      "type": "string"
    },
    "data": {
      "oneOf": [
        { "$ref": "task.schema.json" },
        { "$ref": "jsonrpc_error.schema.json" },
        { 
           "type": "object",
           "required": ["timestamp"],
           "properties": { "timestamp": { "type": "string", "format": "date-time" } }
        }
      ]
    }
  },
  "allOf": [
    {
      "if": { "properties": { "event": { "const": "task.error" } } },
      "then": { "properties": { "data": { "$ref": "jsonrpc_error.schema.json" } } }
    },
    {
      "if": { "properties": { "event": { "const": "heartbeat" } } },
      "then": { 
          "properties": { 
              "data": { 
                  "type": "object", 
                  "required": ["timestamp"], 
                  "properties": { "timestamp": { "type": "string", "format": "date-time" } } 
              } 
          } 
      }
    }
  ],
  "additionalProperties": true
}
